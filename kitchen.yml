---
driver:
  name: vagrant

provisioner:
  name: chef_zero
  # You may wish to disable always updating cookbooks in CI or other testing environments.
  # For example:
  #   always_update_cookbooks: <%= !ENV['CI'] %>
  always_update_cookbooks: true
  # Requires kitchen >= 2.3
  chef_license: accept
  product_name: chef
  product_version: 15.4.45

platforms:
  - name: centos-7

suites:
  - name: default
    run_list:
      - recipe[chef-server::default]
    attributes:
        chef-server:
            accept_license: true
            admins: ['admin1', 'admin2']
            aws_access_key_id: <%= ENV['CHEF_SERVER_AWS_ACCESS_KEY_ID'] %>
            aws_secret_access_key: <%= ENV['CHEF_SERVER_AWS_SECRET_ACCESS_KEY'] %>
            backups_bucket: <%= ENV['CHEF_SERVER_BACKUPS_BUCKET'] %>
            org_short_name: 'revenants'
        postfix:
            smtp_username: <%= ENV['SMTP_USERNAME'] %>
            smtp_password: <%= ENV['SMTP_PASSWORD'] %>
        certbot:
            accept_license: true
            aws_access_key_id: <%= ENV['CERTBOT_AWS_ACCESS_KEY_ID'] %>
            aws_secret_access_key: <%= ENV['CERTBOT_AWS_SECRET_ACCESS_KEY'] %>
            zones: ['foo.com', 'bar.com']
            ssl_admin_email: 'admin@foo.bar'
            dry_run: true
        artifactory:
            username: <%= ENV['ARTIFACTORY_USERNAME'] %>
            password: <%= ENV['ARTIFACTORY_PASSWORD'] %>
